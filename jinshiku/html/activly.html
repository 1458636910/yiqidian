<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
		<title>讲师活跃度</title>
		<link rel="icon" href="../image/eqdLogo.png" type="image/x-icon" />
		<!-- Bootstrap -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.14.1/dist/bootstrap-table.min.css" />
		<!-- <link rel="stylesheet" type="text/css" href="../css/wxbootstrap.css"/> -->
		<link rel="stylesheet" type="text/css" href="../css/activly.css?v=20190919" />
		<!-- HTML5 shim 和 Respond.js 是为了让 IE8 支持 HTML5 元素和媒体查询（media queries）功能 -->
		<!-- 警告：通过 file:// 协议（就是直接将 html 页面拖拽到浏览器中）访问页面时 Respond.js 不起作用 -->
		<!--[if lt IE 9]>
      <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
		<script type="text/javascript">
			;
			(function(doc, win) {
				var docEle = doc.documentElement,
					dpr = Math.min(win.devicePixelRatio, 3),
					scale = 1 / dpr,
					resizeEvent = 'orientationchange' in window ? 'orientationchange' : 'resize';
				var metaEle = doc.createElement('meta');
				metaEle.name = 'viewport';
				metaEle.content = 'initial-scale=' + 1 + ',maximum-scale=' + scale;
				docEle.firstElementChild.appendChild(metaEle);
				var recalCulate = function() {
					var width = docEle.clientWidth;
					docEle.style.fontSize = 10 * (width / 375) + 'px';
				};
				recalCulate();
				if (!doc.addEventListener) return;
				win.addEventListener(resizeEvent, recalCulate, false);
			})(document, window);
		</script>
	</head>
	<body>
		<div class="container">
			<img src="../image/hy1.jpg" class="img-responsive center-block" alt="Responsive image">

			<div class=" col-lg-12 col-md-12  col-sm-12 col-xs-12 labBar">
				<div class="col-xs-4 col-xs-offset-4  col-md-4  col-sm-4 title">
					<img src="../image/hy3.png" class="img-responsive center-block" alt="Responsive image">
				</div>
				<div class="col-xs-4 col-md-4 col-sm-4 text-right lab">

					<p class="lookRule col-xs-6 col-xs-offset-6  col-md-4 col-md-offset-8 col-sm-6 col-sm-offset-6  text-center">查看规则</p>
				</div>
			</div>
			<div class="table-responsive col-lg-12 col-md-12  col-sm-12 col-xs-12">
				<table id="actTable" class="table table-hover table-striped">
					<thead>
						<tr>
							<th><em class="tlab">排名</em></th>
							<th></th>
							<th><em class="tlab">活跃度</em></th>
						</tr>

					</thead>
				</table>
			</div>
			<div class="pageDiv col-lg-12 col-md-12  col-sm-12 col-xs-12">
				<p class="nextpage col-xs-2 col-xs-offset-5  col-md-2 col-md-offset-5 col-sm-2 col-sm-offset-5  text-center">
					下一页
				</p>
			</div>
			<div class=" col-lg-12 col-md-12  col-sm-12 col-xs-12 labBar">
				<div class="col-xs-4 col-xs-offset-4  col-md-4  col-sm-4 title">
					<img src="../image/hy4.png" class="img-responsive center-block" alt="Responsive image">
				</div>
			</div>
			<div class="table-responsive col-lg-12 col-md-12  col-sm-12 col-xs-12">
				<table class="table actRule table ">
					<thead>
						<th class="text-center">操作</th>
						<th class="text-center">活跃度</th>
					</thead>
					<tbody>
						<tr>
							<td>1.完善个人信息</td>
							<td>+1000</td>
						</tr>
						<tr>
							<td>2.发布一个有效课程</td>
							<td>+10</td>
						</tr>
						<tr>
							<td>3.发布一个有效日志</td>
							<td>+10</td>
						</tr>
						<tr>
							<td>4.相册上传一张图片</td>
							<td>+2</td>
						</tr>
						<tr>
							<td>5.发布一个活动</td>
							<td>+10</td>
						</tr>
						<tr>
							<td>6.发布一个视频</td>
							<td>+10</td>
						</tr>
					</tbody>
				</table>
				<h6 class="atention"><strong>特别说明：</strong>如果有评论、点赞、转发，活跃度计算规则如下：自己对别人评论、点赞、转发，每一次各+1活跃度；别人对自己评论、点赞、转发，每一次各+1活跃度</h6>
			</div>
			<img src="../image/hy2.png" class="img-responsive center-block" alt="Responsive image">
		</div>


		<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
		<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
		<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
		<script src="https://unpkg.com/bootstrap-table@1.14.1/dist/bootstrap-table.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.12.1/locale/bootstrap-table-zh-CN.min.js"></script>
		<script type="text/javascript">
			var pageNext = 0;

			function loadTable(data) {
				$("#actTable").bootstrapTable({
					classes: " table-no-bordered",
					columns: [{
						field: 'number',
						align: 'center',
						valign: 'middle',
						formatter: function(value, row, index) {
							var pageSize = 20;
							var this_index = pageSize * pageNext + index + 1;

							if (this_index == 1) {
								return '<img class="sortImg" src="../image/hy5.png" />'
							} else if (this_index == 2) {
								return '<img class="sortImg" src="../image/hy6.png" />'
							} else if (this_index == 3) {
								return '<img class="sortImg" src="../image/hy7.png" />'
							} else {
								return '<span class="sortNum">' + this_index + '</span>'
							}
							// 返回每条的序号： 每页条数 *（当前页 - 1 ）+ 序号

						}
					}, {
						formatter: actList,
					}, {
						field: 'activationNum',
						align: 'center',
						valign: 'middle',
					}],
					data: data
				});

				function actList(e, value, row, index) {
					var img;
					if (value.headimage) {
						img = value.headimage;
					} else {
						img = '../image/hy8.png'
					}
					return '<div class="actDiv"><img class="headImg" src="' + img + '" /><div><p class="tc">' + value.name +
						'</p>  <p class="tc"> <span >' + value.type + '</span><span>' + value.Price + '元/天</span> </p> <p>擅长领域：' + value.ResearchField +
						'</p> </div> </div>'
				};
			};
			
			$('#actTable').on('click-row.bs.table', function(e, row, $element) {
				console.log(row)
                window.open("http://www.eqidd.com/changke/index_start.html?userGuid=" + row.userGuid + "&piece=1");
			});

			function loadFirst(page) {
				setTimeout(function() {
					$.post('http://47.94.173.253:8008/Get_Activations.ashx', {
						"page": page,
					}, function(data) {
						var data = JSON.parse(data);
						console.log("活跃", data);
						if (data.status == 200) {
							loadTable(data.items);
							$("#actTable").bootstrapTable("load", data.items);
							pageNext = data.page;
							if (data.items.length >= 20) {
								$('.nextpage').fadeIn()
							} else {
								$('.nextpage').hide()
							}
						}
					})
				}, 350);
			};
			loadFirst(pageNext)

			function loadNext(page) {
				setTimeout(function() {
					$.post('http://47.94.173.253:8008/Get_Activations.ashx', {
						"page": page,
					}, function(data) {
						var data = JSON.parse(data);
						console.log("活跃", data);
						if (data.status == 200) {
							if (data.items.length > 0) {
								layer.msg("加载成功", {
									time: 1200
								})
							} else {
								layer.msg("没有更多了", {
									time: 1200
								})
							}
							loadTable(data.items);
							$("#actTable").bootstrapTable("append", data.items);
							pageNext = data.page;
							if (data.items.length >= 20) {
								$('.nextpage').show()
							} else {
								$('.nextpage').hide()
							}
						}
					})
				}, 300);
			};
			$('.nextpage').click(function() {
				loadNext(pageNext);
			});
		</script>

	</body>
</html>
